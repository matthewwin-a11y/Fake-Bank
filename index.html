<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fake Bank (PlayFab)</title>
<script src="https://download.playfab.com/PlayFabClientApi.js"></script>
<style>
body { font-family: Arial; background: #050f1a; color: #fff; text-align: center; }
.box { background: #0c253d; width: 420px; margin: 30px auto; padding: 20px; border-radius: 12px; }
input, button { width: 90%; padding: 10px; margin: 6px 0; border-radius: 6px; border: none; }
button { background: #00e676; font-weight: bold; cursor: pointer; }
.hidden { display: none; }
.admin { background: #3b0000; padding: 12px; border-radius: 10px; margin-top: 10px; }
.red { background: #ff5252; }
.green { background: #00bcd4; }
.hint { font-size: 12px; opacity: 0.7; }
</style>
</head>
<body>

<div class="box" id="loginBox">
<h2>Fake Bank Login</h2>
<input id="username" placeholder="Username">
<input id="password" placeholder="Password / PIN">
<button onclick="login()">Log In</button>
<p id="error" style="color:red"></p>
</div>

<div class="box hidden" id="bankBox">
<h2 id="welcome"></h2>
<h3>Balance: <span id="balance"></span></h3>

<input id="toUser" placeholder="Send to username">
<input id="amount" placeholder="Amount (admins can use negative)">
<button onclick="sendMoney()">Send / Take Money</button>

<p id="status"></p>
<p class="hint hidden" id="adminHint">Press <b>E</b> to open Owner / Dev Menu</p>

<div class="admin hidden" id="adminMenu">
<h3>ðŸ‘‘ OWNER / DEV MENU</h3>
<p class="hint">Admin actions only apply to your own account in this demo</p>
<button class="red" onclick="banCurrentAccount()">Ban This Account</button>
<button class="green" onclick="unbanCurrentAccount()">Unban This Account</button>
</div>
</div>

<script>
PlayFab.settings.titleId = "1016D3";

let currentUser = "";
let isAdmin = false;
let users = {};
const currencySymbol = "Â£";

function login() {
  const u = username.value.trim();
  const p = password.value.trim();
  error.textContent = "";
  isAdmin = false;
  adminMenu.classList.add("hidden");
  adminHint.classList.add("hidden");

  // Owner / Dev / Master PIN
  if (u === "MatthewDev" && p === "1899") { isAdmin = true; playfabLogin(u); return; }
  if (u === "DEV" && p === "999") { isAdmin = true; playfabLogin(u); return; }
  if (p === "5563") { playfabLogin(u); return; }

  // Normal login
  playfabLogin(u);
}

function playfabLogin(u) {
  PlayFabClientSDK.LoginWithCustomID({ CustomId: u, CreateAccount: true },
    res => {
      currentUser = u;
      fetchUserData();
    },
    err => { error.textContent = "Login failed: " + err.errorMessage; }
  );
}

// Fetch BANNED flag and balance
function fetchUserData() {
  PlayFabClientSDK.GetUserData({}, res => {
    const d = res.data.Data || {};
    // Check banned
    if (d.BANNED && d.BANNED.Value === "true") {
      error.textContent = "This account is banned.";
      return;
    }
    // Load balance
    users[currentUser] = { balance: d.balance ? Number(d.balance.Value) : (isAdmin ? Infinity : 1000) };
    openBank();
    if (!d.balance) saveBalance();
    if (isAdmin) adminHint.classList.remove("hidden");
    updateBalance();
  }, err => { error.textContent = "Error loading data"; });
}

function openBank() {
  loginBox.classList.add("hidden");
  bankBox.classList.remove("hidden");
  welcome.textContent = "Welcome " + currentUser + (isAdmin ? " (DEV)" : "");
}

function saveBalance() {
  if(users[currentUser].balance !== Infinity){
    PlayFabClientSDK.UpdateUserData({ Data: { balance: users[currentUser].balance.toString() } });
  }
}

function updateBalance() {
  balance.textContent = isAdmin ? currencySymbol + "âˆž" : currencySymbol + users[currentUser].balance;
}

function sendMoney() {
  const amt = Number(amount.value);
  const to = toUser.value.trim();
  if (!to || isNaN(amt) || amt === 0) { status.textContent = "Invalid transaction"; return; }

  if (isAdmin) {
    status.textContent = amt > 0 ? `${currencySymbol}${amt} added to ${to}` : `${currencySymbol}${Math.abs(amt)} removed from ${to}`;
    return;
  }

  if (amt > users[currentUser].balance) { status.textContent = "Not enough money"; return; }

  users[currentUser].balance -= amt;
  updateBalance();
  saveBalance();
  status.textContent = `${currencySymbol}${amt} sent`;
}

function banCurrentAccount() {
  if (!currentUser) return;
  PlayFabClientSDK.UpdateUserData({ Data: { BANNED: "true" } },
    () => { alert(currentUser + " banned on PlayFab"); location.reload(); }
  );
}

function unbanCurrentAccount() {
  if (!currentUser) return;
  PlayFabClientSDK.UpdateUserData({ Data: { BANNED: "false" } },
    () => { alert(currentUser + " unbanned on PlayFab"); fetchUserData(); }
  );
}

// E key opens admin menu (ignores typing)
document.addEventListener("keydown", e => {
  const t = document.activeElement.tagName;
  if ((t === "INPUT" || t === "TEXTAREA") || !isAdmin) return;
  if (e.key.toLowerCase() === "e") adminMenu.classList.toggle("hidden");
});
</script>
</body>
</html>
